# PKMS Backend Dependencies
# Each dependency is annotated with its purpose, key features, and approx. installed size (if significant).
# Remove dev/test-only packages for production to reduce image size.

# --- FastAPI and ASGI Server ---
fastapi==0.104.1           # ğŸš€ Main web framework (async, OpenAPI, validation)
uvicorn[standard]==0.24.0  # âš¡ ASGI server for FastAPI (hot reload, websockets)
gunicorn==21.2.0           # ğŸ­ Production WSGI server (for compatibility, not used with FastAPI directly)

# --- Database and ORM ---
sqlalchemy[asyncio]==2.0.23 # ğŸ—„ï¸  ORM, async DB support, migrations (~23MB)
alembic==1.12.1             # ğŸ”„ DB migrations for SQLAlchemy
aiosqlite==0.19.0           # ğŸ¬ Async SQLite driver (for local dev)

# --- Authentication and Security ---
passlib[bcrypt]==1.7.4      # ğŸ”’ Password hashing (bcrypt, argon2, etc.) (~4.3MB)
python-jose[cryptography]==3.3.0 # ğŸ”‘ JWT, JWE, JWS (token auth)
python-multipart==0.0.6     # ğŸ“¦ Multipart form parsing (file uploads)

# --- Rate Limiting and Security ---
slowapi==0.1.9              # ğŸš¦ Rate limiting for FastAPI (DoS protection)

# --- File Handling ---
aiofiles==23.2.1            # ğŸ“‚ Async file I/O (uploads, downloads)
python-magic==0.4.27        # ğŸ§™ File type detection (libmagic)
pillow==10.1.0              # ğŸ–¼ï¸  Image processing (resize, convert, thumbnails) (~9MB)

# --- PDF and Document Processing ---
PyMuPDF>=1.23.0             # ğŸ“š PREFERRED: Fast PDF text/image extraction (fitz) (~60MB)
                            # âœ… Why PyMuPDF over PyPDF2?
                            # - 50x faster text extraction
                            # - Superior handling of complex/scanned PDFs  
                            # - Image extraction capabilities
                            # - Better for document search (PKMS core feature)
                            # - Memory efficient for large files
                            # PyPDF2 would save 58MB but too slow for PKMS needs
python-docx>=1.1.0          # ğŸ“ MS Word .docx parsing (text extraction)

# --- Smart Tagging with Transformers (Lightweight) ---
transformers==4.36.0        # ğŸ§  Hugging Face transformers for smart tagging (~200MB)
                            # âœ… Smart tagging functionality:
                            # - Text classification and auto-tagging
                            # - Content analysis for documents
                            # - Text summarization for diary entries
                            # - Works with CPU inference (no GPU needed)
                            # - Pre-trained models for various tasks
sentence-transformers==2.2.2 # ğŸ¯ Semantic text similarity (~150MB)
                            # âœ… Advanced text analysis:
                            # - Smart content linking between modules
                            # - Similar document/note detection
                            # - Semantic search improvements
                            # - Find related content automatically
huggingface-hub==0.19.0     # ğŸ¤— Model downloads and management (~10MB)
                            # âœ… Manages pre-trained models:
                            # - Automatic model downloading
                            # - Model version control and caching
                            # - Lightweight model hub interface

# ğŸ”® FUTURE AI EXPANSION (DO NOT INSTALL UNLESS USER REQUESTS):
# 
# For Question & Answer capabilities, consider adding:
# - torch==2.1.0 (~800MB) - PyTorch for T5 model support
# - google/flan-t5-small (~300MB) - Question answering from archive content
# - Text-to-text generation for Q&A interface
# - Chat-like interface for knowledge base queries
# 
# Total additional Docker size: ~1.1GB
# Usage: pip install torch transformers[torch]
# Then modify ai_service.py to include T5 Q&A functionality

# --- Utilities ---
python-dateutil>=2.8.2      # ğŸ“… Date/time parsing
pydantic[email]>=2.5.0      # ğŸ›¡ï¸  Data validation (FastAPI models)
pydantic-settings>=2.1.0    # âš™ï¸  Settings management (env vars)

# --- Development and Testing (remove for production) ---
pytest>=7.4.0               # ğŸ§ª Unit testing (dev only, ~3.2MB)
pytest-asyncio>=0.21.0      # ğŸ§ª Async test support (dev only)
httpx>=0.25.0               # ğŸŒ HTTP client (test/dev only)

# --- Environment variables ---
python-dotenv==1.0.0        # ğŸŒ± Load .env files for config

# --- Security monitoring and logging ---
structlog==23.2.0           # ğŸ“Š Structured logging (advanced, not always used)
prometheus-client==0.19.0   # ğŸ“ˆ Prometheus metrics exporter

# --- Input validation and sanitization ---
bleach>=6.1.0               # ğŸ§¼ HTML sanitization (XSS protection)

# --- Performance & Caching ---
redis==5.0.1                # ğŸš€ Redis client (optional, for caching/sessions)
aiocache==0.12.2            # âš¡ Async caching (multi-backend)

# --- Smart Tagging Impact ---
# ğŸ§  With Transformers: ~1.2GB total Docker image (up from 525MB)
# â”œâ”€â”€ ğŸ§  Transformers: ~200MB       âœ… INSTALLED - Smart tagging models
# â”œâ”€â”€ ğŸ¯ Sentence-transformers: ~150MB âœ… INSTALLED - Semantic analysis
# â”œâ”€â”€ ğŸ¤— HuggingFace Hub: ~10MB     âœ… INSTALLED - Model management
# â””â”€â”€ ğŸ“¦ Dependencies: ~300MB       âœ… INSTALLED - Supporting libraries
#
# ğŸ”® FUTURE EXPANSION (optional):
# â”œâ”€â”€ ğŸ§  PyTorch: ~800MB           â¸ï¸ OPTIONAL - T5 Q&A model support
# â””â”€â”€ ğŸ“š google/flan-t5-small: ~300MB â¸ï¸ OPTIONAL - Question answering
#
# ğŸ“Š Smart Features (CURRENTLY ACTIVE):
# âœ… Automatic content tagging based on text analysis
# âœ… Smart document categorization (work, personal, research, etc.)
# âœ… Diary entry sentiment and topic analysis
# âœ… Related content suggestions across modules
# âœ… Improved search with semantic similarity
# âœ… Auto-linking between related notes/documents
# âœ… Content summarization capabilities
#
# ğŸ”® OPTIONAL FEATURES (if PyTorch + T5 added):
# â¸ï¸ Question answering from archive content (via T5)
# â¸ï¸ Chat-like interface for knowledge base queries

# --- Size Justification ---
# Transformers add ~700MB to Docker image but provide:
# - Automatic smart tagging (saves hours of manual categorization)
# - Content discovery and cross-module linking
# - Enhanced search with semantic understanding
# - Text summarization for long documents/diary entries
# - Future-ready for advanced AI features
#
# Benefits far outweigh the size cost for a knowledge management system.
# Users can disable AI features if size is critical.

# ğŸ“ /opt (233MB) - Python Virtual Environment
# â”œâ”€â”€ ğŸ PyMuPDF: 60MB        âœ… USED - PDF processing
# â”œâ”€â”€ ğŸ—„ï¸ SQLAlchemy: 23MB     âœ… USED - Database ORM
# â”œâ”€â”€ ğŸ“¦ pip: 17MB            âœ… USED - Package manager
# â”œâ”€â”€ âš¡ uvloop: 14MB         âœ… USED - Fast event loop
# â”œâ”€â”€ ğŸ” cryptography: 14MB   âœ… USED - Authentication/security
# â”œâ”€â”€ ğŸ“„ lxml: 12MB           âœ… USED - XML/HTML processing
# â”œâ”€â”€ ğŸ¨ Pygments: 9.3MB      âŒ NOT USED - Code highlighting
# â”œâ”€â”€ ğŸ–¼ï¸ Pillow.libs: 9.1MB   âœ… USED - Image processing deps
# â”œâ”€â”€ ğŸ› ï¸ setuptools: 6.7MB    âœ… USED - Build tools
# â”œâ”€â”€ âœ… pydantic_core: 5.0MB âœ… USED - Data validation
# â”œâ”€â”€ ğŸ”’ passlib: 4.3MB      âœ… USED - Password hashing
# â”œâ”€â”€ ğŸ“Š pydantic: 4.1MB     âœ… USED - Data validation
# â”œâ”€â”€ ğŸ–¼ï¸ PIL: 3.5MB          âœ… USED - Image processing
# â”œâ”€â”€ ğŸ§ª pytest: 3.2MB       âŒ NOT USED IN PROD - Testing
# â””â”€â”€ ğŸ“ yaml: 3.0MB         âœ… USED - Config parsing

# ğŸ“ /usr (133MB) - System libraries
# ğŸ“ /var (7.0MB) - Variable data
# ğŸ“ /etc (1.4MB) - Configuration files
# ğŸ“ /app (512KB) - Your application code

# Packages Currently NOT Used (can be removed for production):
# âŒ Pygments (9.3MB) - Code syntax highlighting
# âŒ pytest + pytest-asyncio (3.2MB) - Testing framework
# âŒ httpx (included in deps) - HTTP client for testing
# âŒ structlog - Advanced logging (not in current code)